name: Maven Package

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write  # 必需：允许向 GitHub Packages 写入

    steps:
      - uses: actions/checkout@v4  # 拉取代码

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          server-id: github  # 与 pom.xml 中 distributionManagement/repository/id 一致
          settings-path: ${{ github.workspace }}  # 自动生成包含 GITHUB_TOKEN 的 settings.xml
          # 自动配置认证信息（无需手动写 settings.xml）

      - name: 构建项目（编译+打包）
        run: mvn -B clean package --file pom.xml  # 清理并打包，生成 Jar 包

      - name: 上传 Jar 包作为 Artifact（方便下载）
        uses: actions/upload-artifact@v4
        with:
          name: SpigotPluginCreaterTool-Jar  #  artifacts 名称
          path: target/*.jar  # 上传 target 目录下所有 Jar 包（包含构建好的产物）
          if-no-files-found: error  # 若未找到 Jar 包则报错