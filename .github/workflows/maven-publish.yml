name: Maven Build and Package
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read  # 仅需读取代码权限

    steps:
      - uses: actions/checkout@v4  # 拉取代码

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: 构建 Jar 包（编译+打包）
        run: mvn -B clean package --file pom.xml  # 生成 target 下的所有 Jar 包

      # 步骤1：上传「所有Jar包的压缩包」，名称加后缀 -AllJars-ZIP
      - name: 上传所有Jar压缩包（带后缀）
        uses: actions/upload-artifact@v4
        with:
          name: SpigotPluginCreaterTool-AllJars-ZIP  # 压缩包名称带后缀，明确区分
          path: target/*.jar  # 把 target 下所有 Jar 打包成 ZIP
          if-no-files-found: error

      # 步骤2：上传「单个可执行Jar包」（需替换为你实际的Jar包名称）
      - name: 上传单个可执行Jar包
        uses: actions/upload-artifact@v4
        with:
          name: SpigotPluginCreaterTool-Executable  # 单个Jar包的名称
          # ！！替换为你 target 目录下实际的可执行Jar包名称（如带依赖的shaded Jar）
          # 示例：target/SpigotPluginCreaterTool-0.0.2.jar（版本号需和pom.xml一致）
          path: target/SpigotPluginCreaterTool-0.0.2.jar
          if-no-files-found: error